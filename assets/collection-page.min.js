(()=>{var f=class extends HTMLElement{constructor(){super();this.isLoading=!1,this.initEventHandler()}initEventHandler(){let t=i=>{let r=this;return function(n){let l=r.getBoundingClientRect(),a=r.getInfo();!r.isLoading&&a.nextPage&&window.pageYOffset+1e3>=l.y&&i()}};Object.assign(this,{unobserver:()=>{window.removeEvent("scroll",this.scrollHandler),this.removeEvent("click",this.scrollHandler)},observer(i){this.scrollHandler=t(i),this.unobserver(),window.addEvent("scroll",this.scrollHandler),this.addEvent("click",this.scrollHandler)}})}reset(){this.setAttribute("data-current-page",1),this.setAttribute("data-next-page",1)}setStatus(t){switch(t){case"hide":this.addClass("d-none");break;case"show":this.removeClass("d-none");break;case"loading":this.setAttribute("loading",""),this.isLoading=!0;break;case"loaded":this.removeAttribute("loading"),this.isLoading=!1;break;case"reset":this.setAttribute("data-current-page",1),this.setAttribute("data-next-page",1);break}}setInfo({currentPage:t,nextPage:i}){this.setAttribute("data-current-page",t),this.setAttribute("data-next-page",i)}getInfo(){return{currentPage:+this.getAttribute("data-current-page"),nextPage:+this.getAttribute("data-next-page")}}};var y={onLoad(){let{container:e}=this;this.elms={sortBy:e.querySelectorAll(".select-sort-by"),productGridContainer:e.querySelector("#main-collection-product-grid"),maxlistMore:e.getElementsByClassName("maxlist-more"),maxlistLess:e.getElementsByClassName("maxlist-less"),productsShowing:e.querySelector("#products-showing"),infiniteButton:e.querySelector("infinite-button"),sidebarContainer:e.querySelector("#main-collection-filters"),collectionProductGridList:e.querySelector("#collection-product-grid-container"),paginationContainer:e.querySelectorAll(".pagination-container"),formFilter:e.querySelector("#collection-filters-form"),selectGroup:e.querySelector(".group-type-list-wrapper"),mobileFilterIcon:e.querySelector(".mobile-filter-icon"),jsSidebarClose:e.querySelector(".js-sidebar-close")},this.canceLoadProducts=!1,this.filterData={},this.settings=JSON.parse(this.container.querySelector("script[data-collection-settings]").innerHTML),this.filterActiveValues=[],this.settings.paginationType=="infinite"&&this.loadProducts().then(()=>this.initInfiniteButton()),this.initFilter(),this.initFilterDrawerMobile(),this.initSortBy(),this.initGridList()},getQueryString(){let{formFilter:e}=this.elms,t=new FormData(e);return new URLSearchParams(t).toString()},initFilterDrawerMobile(){let{mobileFilterIcon:e,jsSidebarClose:t}=this.elms;e.addEvent("click",function(){document.querySelector("html").classList.add("overflow-hidden"),document.querySelector("body").classList.add("active-sidebar")}),t.addEvent("click",function(){document.querySelector("html").classList.remove("overflow-hidden"),document.querySelector("body").classList.remove("active-sidebar")})},initSortBy(){if(this.settings.enableSort){let{sortBy:e}=this.elms;e&&e.forEach(t=>{t.addEvent("change",()=>{e.forEach(i=>{i.value=t.value}),this.settings.paginationType=="infinite"?this.loadProducts("sort-by"):this.updatePage("sort-by")})})}},initFilter(){let{formFilter:e}=this.elms,t=this;if(!e)return;t.initmaxlist();let i=document.querySelectorAll(".filter-group-display__list-item_checkbox"),r=document.querySelectorAll(".filter-group-display__submit input");r&&r.forEach(n=>{n.addEvent("click",l=>{l.preventDefault(),t.updatePage("filter")})}),i.forEach(n=>{n.addEvent("change",function(){t.updatePage("filter")})})},initmaxlist(){let{maxlistMore:e,maxlistLess:t}=this.elms;e.forEach(i=>{i.addEvent("click",function(){let r=this.closest(".filter-maxlist");this.addClass("d-none"),this.closest(".filter-group_inner").addClass("maxlist-more-active"),r.querySelector(".maxlist-less").removeClass("d-none")})}),t.forEach(i=>{i.addEvent("click",function(){let r=this.closest(".filter-maxlist");this.addClass("d-none"),this.closest(".filter-group_inner").removeClass("maxlist-more-active"),r.querySelector(".maxlist-more").removeClass("d-none")})})},initInfiniteButton(){let{infiniteButton:e,paginationContainer:t}=this.elms;!customElements.get("infinite-button")&&customElements.define("infinite-button",f),e.getInfo().nextPage&&(e.observer(this.onInfiniteHandler.bind(this)),t&&t.forEach(i=>{i.removeClass("d-none")}))},onInfiniteHandler(){let{infiniteButton:e}=this.elms,{nextPage:t,currentPage:i}=e.getInfo();if(t){i++;let r=this.getSearchParams("infinite",i);e.setStatus("loading"),this.updatePage("infinite",r).then(()=>e.setStatus("loaded"))}},updateCart(e,t){let i=e;fetch(window.Shopify.routes.root+"cart/update.js",{method:"POST",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json;"},body:JSON.stringify({attributes:i})}).then(r=>{r.json().then(n=>{t&&this.updatePage("show-by")})}).catch(r=>{console.log(r)})},async loadProducts(e){let t=+this.getPageNumber();for(let i=1;i<=t;i++){let r=this.getSearchParams("load-products",i);if(this.canceLoadProducts){this.canceLoadProducts=!1;break}await this.updatePage("load-products",r,i,e)}},async updatePage(e,t,i,r){return!t&&(t=this.getSearchParams(e)),new Promise((n,l)=>{AT.queue.add(this.getPage(t),a=>{switch(e){case"sort-by":{this.renderPage(a,e),this.updateURLHash(t);break}case"show-by":{this.renderPage(a,e),this.updateURLHash(t);break}case"filter":{this.renderPage(a,e),this.updateURLHash(t);break}case"load-products":{this.renderPage(a,e,i,r),r=="sort-by"&&this.updateURLHash(t);break}case"infinite":{this.renderPage(a,e),this.updateURLHash(t);break}}n(1)})})},async renderPage(e,t,i,r){let{sidebarContainer:n,selectGroup:l,productGridContainer:a,paginationContainer:d,productsShowing:m,infiniteButton:p}=this.elms;switch(t){case"sort-by":a.innerHTML=e.querySelector("#main-collection-product-grid").innerHTML,this.settings.paginationType!=="infinite"&&d&&d.forEach(o=>{o.innerHTML=e.querySelector(".pagination-container").innerHTML.replace(/&view=ajax/g,"").replace(/&amp;view=ajax/g,"")});break;case"show-by":a.innerHTML=e.querySelector("#main-collection-product-grid").innerHTML,this.settings.paginationType!=="infinite"&&d&&d.forEach(o=>{o.innerHTML=e.querySelector(".pagination-container").innerHTML.replace(/&view=ajax/g,"").replace(/&amp;view=ajax/g,"")});break;case"filter":a.innerHTML=e.querySelector("#main-collection-product-grid").innerHTML,l.innerHTML=e.querySelector(".group-type-list-wrapper").innerHTML,n.addClass("active-ajax"),this.initmaxlist();let g=document.querySelector(".js-range-slider");if(g){let o=g.querySelectorAll('input[type="range"]'),c=g.querySelectorAll('input[type="number"]');o.forEach(s=>{s.setAttribute("value",Number(s.getAttribute("value"))),s.setAttribute("max",Number(s.getAttribute("max"))),s.oninput=()=>{let u=parseFloat(o[0].value),h=parseFloat(o[1].value);u>h&&([u,h]=[h,u]),c[0].value=u,c[1].value=h}}),c.forEach(s=>{s.setAttribute("value",Number(s.getAttribute("value"))),s.setAttribute("max",Number(s.getAttribute("max"))),Number(c[1].value==0)&&(c[1].value=Number(c[1].getAttribute("max"))),s.oninput=()=>{let u=parseFloat(c[0].value),h=parseFloat(c[1].value);if(u>h){let b=u;c[0].value=h,c[1].value=b}o[0].value=u,o[1].value=h}}),document.querySelector(".filter-price-button").addEvent("click",function(){let s=g.querySelector(".field__input-min").value,u=g.querySelector(".field__input-max").value;document.querySelector(".main-range-slider .field__input-min").value=s,document.querySelector(".main-range-slider .field__input-max").value=u,document.querySelector(".filter-price-submit").click()}),d&&d.forEach(s=>{s.innerHTML=e.querySelector(".pagination-container").innerHTML.replace(/&view=ajax/g,"").replace(/&amp;view=ajax/g,"")})}break;case"infinite":!!m&&(m.innerHTML=e.querySelector("#products-showing").innerHTML);case"load-products":r=="sort-by"&&i==1&&(a.innerHTML=""),e.querySelectorAll("product-card").forEach(o=>a.append(o))}if(this.settings.paginationType==="infinite"&&t!="load-products"){let{currentPage:g,nextPage:o}=e.querySelector("infinite-button").dataset;+o?(d.removeClass("d-none"),p.observer(this.onInfiniteHandler.bind(this))):(d.addClass("d-none"),p.unobserver()),p.setInfo({currentPage:g,nextPage:o})}},getSearchParams(e,t){let{sortBy:i}=this.elms,r=[AT.getParameterByName("q")?`q=${AT.getParameterByName("q")}`:"",...Object.keys(this.filterActiveValues).reduce((l,a)=>(this.filterActiveValues[a].length&&l.push(`${a}=${this.filterActiveValues[a].map(encodeURIComponent).join(",")}`),l),[]),i?`sort_by=${i[0].value}`:""];switch(e){case"sort-by":r.unshift(`page=${this.getPageNumber()}`);break;case"show-by":r.unshift("page=1");break;case"load-products":r.unshift(`page=${t}`);break}let n=this.getQueryString();return r.unshift(n),r.filter(Boolean).join("&")},getPage(e){let t=this.container.dataset.sectionId,i=`${window.location.pathname}?${e}&section_id=${t}`;return fetch(i,{dataType:"text"}).then(r=>{let n=document.createElement("div");return n.innerHTML=r,this.filterData[i]=n.cloneNode(!0),n})},getPageNumber(){return AT.getParameterByName("page")||1},updateURLHash(e){history.pushState({},"",`${window.location.pathname}${e&&"?".concat(e)}`)},initGridList(){let{collectionProductGridList:e}=this.elms;if(e.querySelector(".grid-list")){let i=e.querySelectorAll(".grid"),r=this;i.forEach(function(n){n.addEvent("click",function(){let l=this.getAttribute("data-grid");e.className="",e.addClass(l),r.updateCart({gridView:l},!1)})})}},getFilterActiveValues(){let e=JSON.parse(this.container.querySelector("script[data-collection-filter-active-values]").innerHTML);return window.location.search.replace("?","").split("&").forEach(t=>{let[i,r]=t.split(/=(.+)/);i in e&&r&&!e[i].includes(r)&&e[i].push(r)}),e}};register("collection-template",y);load("collection-template");console.log("collection-page.js loaded");})();
