(()=>{var C={onLoad(){this.elms={cartSubtotalPrice:this.container.querySelector(".js-cart-subtotal-price"),cartTotalPrice:this.container.querySelector(".js-cart-total-price"),lineItemList:this.container.getElementsByClassName("js-cart-line-item"),lineItemsContainer:this.container.querySelector("#cart-line-items"),estimateShipping:this.container.querySelector("#shipping-calculator"),cartForm:this.container.querySelector("#cart-form"),cartNote:this.container.querySelector("#cart-note"),checkoutSubmitButton:this.container.querySelector("#checkout-submit-button")},document.addEvent("cart-change",this.onCartChangeHandler.bind(this)),document.addEvent("cart-add",this.onCartAddHandler.bind(this)),this.initEstimateShipping(),this.initCartNote(),this.initCheckoutSubmitButton()},onCartAddHandler({detail:{sections:e,...t}}){let{lineItemsContainer:n}=this.elms;n.innerHTML=e["cart-template"];let i=n.querySelector(`cart-line-item[data-key='${t.key}']`);AT.scrollTo(i,1e3,300).then(()=>{i.addClass("line-item--highlight"),AT.debounce(()=>i.removeClass("line-item--highlight"),1e3)})},onCartChangeHandler({detail:{original_total_price:e,total_price:t,item_count:n}}){let{cartSubtotalPrice:i,cartTotalPrice:r}=this.elms;i.innerHTML=e.toCurrency(),r.innerHTML=t.toCurrency(),this.container.setAttribute("data-status",n)},initEstimateShipping(){let{estimateShipping:e}=this.elms;if(!e)return;let t=e.querySelector("form"),n=e.querySelector("#shipping-calculator-country"),i=e.querySelector("#shipping-calculator-province"),r=i.closest(".province"),c=e.querySelector(".js-message-container"),m=e.querySelector(".js-error-message"),s=e.querySelector(".js-shipping-calculator-results"),y=/\{\{\s*(\w+)\s*\}\}/,v="amount_no_decimals,amount_no_decimals_with_comma_separator,amount_no_decimals_with_space_separator",p=n.dataset.default;n.addEvent("change",function(){let u=JSON.parse(this.options[this.selectedIndex].dataset.provinces);u.length?(r.removeClass("d-none"),u.forEach(h=>{let o=document.createElement("option");o.value=h[0],o.innerHTML=h[1],i.append(o)})):(r.addClass("d-none"),i.value="")}),p&&(n.value=p,n.dispatchEvent(new Event("change"))),t.addEvent("submit",function(u){u.preventDefault();let h=new FormData(this),o=new URLSearchParams(h).toString();this.addClass("pending"),fetch(`/cart/shipping_rates.json?${o}`,{dataType:"json"}).then(({shipping_rates:a})=>{c.addClass("d-none"),console.log(a),a.length?(s.querySelector("p").innerHTML=a.length>1?theme.strings.shipping.manyRates.replace("{{number}}",a.length):theme.strings.shipping.oneRate,s.querySelector("ul").innerHTML=a.reduce((l,d)=>(l+=`<li>${d.name}: ${(v.includes(theme.currency.format.match(y)[1])?d.price*100:d.price).toCurrency()}</li>`,l),"")):(s.querySelector("ul").innerHTML="",s.querySelector("p").innerHTML=theme.strings.shipping.notFoundRate),s.removeClass("d-none")}).catch(a=>{let l=Object.keys(a)[0];m.innerHTML=`${l} ${a[l]}`,c.removeClass("d-none"),s.addClass("d-none")}).finally(()=>this.removeClass("pending"))})},initCartNote(){let{cartNote:e,cartForm:t}=this.elms;e&&e.querySelector("textarea").addEvent("input",function(n){e.querySelector(".js-char-counter").innerHTML=this.value.length,t.querySelector("textarea[name='note']").value=this.value})},initCheckoutSubmitButton(){let{cartForm:e,checkoutSubmitButton:t}=this.elms;t&&t.addEvent("click",function(){this.addClass("pending"),e.querySelector("button[name='checkout']").click()})}},g=class extends HTMLElement{constructor(){super();this.elms={totalPrice:this.querySelector(".js-total-price"),removeButton:this.querySelector(".js-remove-btn"),quantityInput:this.querySelector("quantity-input")},this.onChangeHandler(),this.onRemoveHandler()}onChangeHandler(){let{quantityInput:t,totalPrice:n}=this.elms;customElements.whenDefined("quantity-input").then(()=>{t.onChange(i=>{Cart.change(this.dataset.id,i).then(r=>{let{final_line_price:c}=r.items.find(m=>m.id==this.dataset.id);n.innerHTML=c.toCurrency(),document.dispatchEvent(new CustomEvent("cart-change",{detail:r}))})})})}onRemoveHandler(){let{removeButton:t}=this.elms;t.addEvent("click",n=>{n.preventDefault(),t.addClass("pending"),this.css("height",this.offsetHeight+"px"),Cart.remove(this.dataset.id).then(i=>{document.dispatchEvent(new CustomEvent("cart-remove",{detail:i})),this.addClass("is-removing"),AT.debounce(()=>{this.remove()},500)()})})}};!customElements.get("cart-line-item")&&customElements.define("cart-line-item",g);register("cart-template",C);load("cart-template");console.log("cart-page loaded");})();
